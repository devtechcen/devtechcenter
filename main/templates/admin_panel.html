{% extends "base.html" %}
{% block content %}
<div class="profile-wrapper">
  <h2>Список всех заявок</h2>

  <form method="get" class="filter-form" style="margin-bottom: 1rem;">
  <label for="manager">Фильтр по менеджеру:</label>
  <select name="manager" id="manager" onchange="this.form.submit()">
    <option value="" {% if not selected_manager_id %}selected{% endif %}> Все заявки </option>
    <option value="none" {% if selected_manager_id == "none" %}selected{% endif %}> Не назначенные </option>
    {% for manager in managers %}
      <option value="{{ manager.id }}" {% if selected_manager_id == manager.id|stringformat:"s" %}selected{% endif %}>
        {{ manager.username }}
      </option>
    {% endfor %}
  </select>
  <noscript>
    <button type="submit" class="btn-small">Применить</button>
  </noscript>
</form>


  <div class="table-container">
    <table class="submission-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Название</th>
          <th>Дата подачи</th>
          <th>Ответственный</th>
          <th>Статус</th>
          <th>Дата обработки</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for sub in submissions %}
        <tr>
          <td>{{ sub.id }}</td>
          <td>{{ sub.name }}</td>
          <td>{{ sub.submission_date|date:"d.m.Y H:i" }}</td>
          <td>{{ sub.employee.username|default:"-" }}</td>
          <td>{{ sub.status }}</td>
          <td>
            {% if sub.processed_at %}{{ sub.processed_at|date:"d.m.Y H:i" }}{% else %}-{% endif %}
          </td>
          <td>
            <a href="{% url 'admin_submission_detail' sub.id %}" class="btn-small btn-edit">Подробнее</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7">Заявки не найдены.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
